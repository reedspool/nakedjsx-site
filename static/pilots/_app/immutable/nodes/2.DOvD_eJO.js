import{a as g,t as z,c as ve}from"../chunks/disclose-version.CLXa-AFD.js";import{h as xe,C as rt,Q as er,a0 as tr,A as rr,b as nr,z as ar,_ as Ot,H as ir,B as wt,D as nt,c as Ue,W as or,as as Ke,F as Dt,a as Nt,G as sr,w as xt,at as lr,au as ur,Z as cr,av as dr,d as fr,O as vr,an as pr,s as Pt,aw as _r,ax as mr,ay as yr,T as gr,az as hr,y as br,aA as kr,p as Lt,a6 as O,i as Ut,r as A,v as i,ar as Ee,a7 as f,a9 as d,a8 as u,a5 as D,u as wr,n as ft,e as xr,g as L}from"../chunks/runtime.Bm73Tpmf.js";import{d as Bt,s as F}from"../chunks/render.BfQ3xYTj.js";import{i as K,b as Pr,p as Er}from"../chunks/this.CnBV6IW7.js";import{s as $t}from"../chunks/snippet.Cwy7Ud8A.js";import{o as Ir}from"../chunks/index-client.B3YRV3HL.js";function at(e,t){return t}function Cr(e,t,r,n){for(var a=[],s=t.length,o=0;o<s;o++)ur(t[o].e,a,!0);var v=s>0&&a.length===0&&r!==null;if(v){var _=r.parentNode;cr(_),_.append(r),n.clear(),Pe(e,t[0].prev,t[s-1].next)}dr(a,()=>{for(var C=0;C<s;C++){var S=t[C];v||(n.delete(S.k),Pe(e,S.prev,S.next)),fr(S.e,!v)}})}function it(e,t,r,n,a,s=null){var o=e,v={flags:t,items:new Map,first:null};{var _=e;o=xe?rt(er(_)):_.appendChild(tr())}xe&&rr();var C=null,S=!1;nr(()=>{var p=r(),h=ar(p)?p:p==null?[]:Ot(p),m=h.length;if(S&&m===0)return;S=m===0;let l=!1;if(xe){var P=o.data===ir;P!==(m===0)&&(o=wt(),rt(o),nt(!1),l=!0)}if(xe){for(var T=null,Y,E=0;E<m;E++){if(Ue.nodeType===8&&Ue.data===or){o=Ue,l=!0,nt(!1);break}var b=h[E],w=n(b,E);Y=qt(Ue,v,T,null,b,w,E,a,t),v.items.set(w,Y),T=Y}m>0&&rt(wt())}if(!xe){var c=vr;Sr(h,v,o,a,t,(c.f&Ke)!==0,n)}s!==null&&(m===0?C?Dt(C):C=Nt(()=>s(o)):C!==null&&sr(C,()=>{C=null})),l&&nt(!0),r()}),xe&&(o=Ue)}function Sr(e,t,r,n,a,s,o,v){var _=e.length,C=t.items,S=t.first,p=S,h,m=null,l=[],P=[],T,Y,E,b;for(b=0;b<_;b+=1){if(T=e[b],Y=o(T,b),E=C.get(Y),E===void 0){var w=p?p.e.nodes_start:r;m=qt(w,t,m,m===null?t.first:m.next,T,Y,b,n,a),C.set(Y,m),l=[],P=[],p=m.next;continue}if(Tr(E,T,b),E.e.f&Ke&&Dt(E.e),E!==p){if(h!==void 0&&h.has(E)){if(l.length<P.length){var c=P[0],x;m=c.prev;var G=l[0],B=l[l.length-1];for(x=0;x<l.length;x+=1)Et(l[x],c,r);for(x=0;x<P.length;x+=1)h.delete(P[x]);Pe(t,G.prev,B.next),Pe(t,m,G),Pe(t,B,c),p=c,m=B,b-=1,l=[],P=[]}else h.delete(E),Et(E,p,r),Pe(t,E.prev,E.next),Pe(t,E,m===null?t.first:m.next),Pe(t,m,E),m=E;continue}for(l=[],P=[];p!==null&&p.k!==Y;)(s||!(p.e.f&Ke))&&(h??(h=new Set)).add(p),P.push(p),p=p.next;if(p===null)continue;E=p}l.push(E),m=E,p=E.next}if(p!==null||h!==void 0){for(var k=h===void 0?[]:Ot(h);p!==null;)(s||!(p.e.f&Ke))&&k.push(p),p=p.next;var y=k.length;if(y>0){var I=_===0?r:null;Cr(t,k,I,C)}}xt.first=t.first&&t.first.e,xt.last=m&&m.e}function Tr(e,t,r,n){lr(e.v,t),e.i=r}function qt(e,t,r,n,a,s,o,v,_,C){var S=(_&mr)!==0,p=(_&yr)===0,h=S?p?pr(a):Pt(a):a,m=_&_r?Pt(o):o,l={i:m,v:h,k:s,a:null,e:null,prev:r,next:n};try{return l.e=Nt(()=>v(e,h,m),xe),l.e.prev=r&&r.e,l.e.next=n&&n.e,r===null?t.first=l:(r.next=l,r.e.next=l.e),n!==null&&(n.prev=l,n.e.prev=l.e),l}finally{}}function Et(e,t,r){for(var n=e.next?e.next.e.nodes_start:r,a=t?t.e.nodes_start:r,s=e.e.nodes_start;s!==n;){var o=gr(s);a.before(s),s=o}}function Pe(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Fr(e,t){var r=e.__attributes??(e.__attributes={});r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t)}function Be(e,t,r,n){var a=e.__attributes??(e.__attributes={});xe&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[hr]=r),r==null?e.removeAttribute(t):typeof r!="string"&&zr(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var It=new Map;function zr(e){var t=It.get(e.nodeName);if(t)return t;It.set(e.nodeName,t=[]);for(var r,n=e,a=Element.prototype;a!==n;){r=kr(n);for(var s in r)r[s].set&&t.push(s);n=br(n)}return t}function Ar(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function Ae(e,t,r,n){var a=e.__styles??(e.__styles={});a[t]!==r&&(a[t]=r,e.style.setProperty(t,r,""))}var Mr=z('<button class="svelte-13gl6av"><i class="material-icons md-36"> </i></button>'),Rr=z('<div class="fs svelte-13gl6av"><!> <!></div>');function Or(e,t){Lt(t,!0);let r=Ee(!1),n=Ee(null);const a=()=>{};let s=Ee(a),o=Ee(a),v=Ee(!1);Ir(()=>{A(o,()=>{(i(n).requestFullscreen||i(n).mozRequestFullScreen||i(n).webkitRequestFullscreen||i(n).msRequestFullscreen||a).bind(i(n))()}),A(s,Er((document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen||a).bind(document))),A(v,!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled));const l=document.createElement("link");return l.rel="stylesheet",l.href="https://fonts.googleapis.com/icon?family=Material+Icons",document.head.appendChild(l),()=>{l.parentNode.removeChild(l)}});const _=()=>{i(v)&&(i(r)?i(s)():i(o)(i(n)),A(r,!i(r)))};let C=D(()=>i(r)?"fullscreen_exit":"fullscreen");var S=Rr(),p=f(S);$t(p,()=>t.fullscreenable,()=>i(v),()=>_);var h=d(p,2);{var m=l=>{var P=Mr();P.__click=_;var T=f(P),Y=f(T,!0);u(T),u(P),O(()=>F(Y,i(C))),g(l,P)};K(h,l=>{!t.fullscreenable&&i(v)&&l(m)})}u(S),Pr(S,l=>A(n,l),()=>i(n)),O(()=>Ar(S,"isFull",i(r))),g(e,S),Ut()}Bt(["click"]);const Dr=e=>Math.floor(Math.random()*e),Nr=e=>e[Dr(e.length)],W=(e,t,r)=>Math.min(r,Math.max(e,t)),ot=25,Lr={core:{type:"core",components:["targeter","health"],title:"Core",description:"Processing, control, mechanical center"},bipedalLegs:{type:"bipedalLegs",components:["fuel","stance"],title:"Legs",description:"Stand, shift, and shuffle on two feet"},autopistol:{type:"autopistol",components:["autopistol","targeter"],title:"Gun",description:"Chk chk boom"},sword:{type:"sword",components:["sword","targeter","fuel"],title:"Sword",description:"Schwa-schwa-krang"},shield:{type:"shield",components:["shield","fuel"],title:"Shield",description:"A fancy name for a metal slab"},taser:{type:"taser",components:["targeter","taser","generator","battery"],title:"Taser",description:"Zzztt"},hackingModule:{type:"hackingModule",components:["targeter","hackingModule","hackingToggle","generator","battery"],title:"Taser",description:"Zzztt"}},$e=()=>({parentType:"resource",min:0,max:100,value:100,velocity:0,formatter:e=>Math.trunc(e)}),He=()=>({parentType:"sliderInput",min:0,max:100,value:100,formatter:e=>Math.trunc(e)}),Ur={fuel:{type:"fuel",...$e(),velocity:1},battery:{type:"battery",...$e(),max:1e3,value:200,velocity:-1},generator:{type:"generator",...He(),max:3,value:1,fuelCost:1,batteryGenerationAmount:1,chargeExponent:1.1},taser:{type:"taser",...He(),max:1,value:0,batteryCostRatio:16,damageScaleExponent:1e-4},health:{type:"health",...$e()},autopistol:{type:"autopistol",...$e(),max:3,costPerShot:3,powerPerShot:5,value:0,velocity:.01},sword:{type:"sword",parentType:"unique",costPerSwing:90,baseDamage:25,value:0,min:0,max:100,velocity:1,formatter:e=>Math.trunc(e),swinging:!1},shield:{type:"shield",parentType:"unique",costPer:90,value:0,min:0,max:100,velocity:1.6,totalUses:3,numUses:3,formatter:e=>Math.trunc(e),blocking:!1},stance:{type:"stance",...He(),min:-1,max:1,value:0},targeter:{type:"targeter",parentType:"unique",targetEntityId:null},hackingModule:{type:"hackingModule",...$e(),value:0,max:100,velocity:0,progressPerCharge:1,chargeCost:16,phase:"scanning components",targetedComponentType:null,successChance:.8,resourceLossRatio:6},hackingToggle:{type:"hackingToggle",...He(),value:0,max:1}},q=(e,t,r)=>{e.log.push({timestamp:Ie(),entry:r,level:t}),console.log("Log",e.log.at(-1))},Br=e=>{const t=e.round.state;if(t!=="occurring"&&t!=="paused"){console.error("Paused when round not playing");return}e.round=t==="occurring"?{state:"paused"}:{state:"occurring"}},$r=()=>{const e=Ie();return{mostRecentUpdate:e,round:{state:"not yet started"},log:[],inputChanges:[],remainingLag:0,gameStartedTime:e,entities:[],components:[],parts:[],optimistic:[]}},Me=(e,t,r)=>{const n=e.components.find(a=>a.entityId===t&&a.type===r);if(n)return Kt(n,r)},U=(e,t,r)=>{const n=e.components.find(a=>a.entityId===t&&a.type===r);if(!n){const a=De(e,t);throw new Error(`${r}' required for '${a==null?void 0:a.debug}' (${a==null?void 0:a.entityId})`)}return Kt(n,r)},De=(e,t)=>{let r=e.entities.find(n=>n.entityId===t);return r||(r={debug:"Unknown entity",entityId:-1}),r},Ie=()=>Math.trunc(performance.now()),Gt=e=>{const t=Ie();return{...e,round:{state:"occurring"},log:[],gameStartedTime:t,mostRecentUpdate:t}};let qr=0;const Ct=(e,t)=>{let r=qr++;return e.entities.push({entityId:r,debug:t}),r},Re=(e,t,r)=>{const n=Lr[r];e.parts.push({...n,entityId:t}),n.components.forEach(a=>{Ht(e,t,a)})},Gr=(e,t,r)=>{e.parts=e.parts.filter(n=>!(t===n.entityId&&r===n.type)),Hr(e,t)},Hr=(e,t)=>{e.components=e.components.filter(r=>r.entityId!==t),e.parts.filter(r=>r.entityId===t).forEach(r=>r.components.forEach(n=>{Ht(e,r.entityId,n)}))},Ht=(e,t,r)=>{{let n=Ur[r];if(e.components.find(s=>s.entityId===t&&s.type==r))return;let a={...n,entityId:t};e.components.push(a)}};function Kt(e,t){if(!e)throw new Error;if(e.type!==t)throw Error(`expected tag ${t} but was ${e.type}`);return e}const st=(e,t)=>{e.inputChanges.push(t)},Kr=e=>{const r=Ie()-e.mostRecentUpdate;e.mostRecentUpdate=Ie(),e.remainingLag+=r;let n=0;for(;e.remainingLag>=ot;)if(Wr(e),n++,e.remainingLag-=ot,n>100){q(e,"debug","Lag recovery spinout");break}n>1&&q(e,"debug",`Updated ${n} times to recover from lag`);const a=e.remainingLag/ot;Yr(e,a)},lt=(e,t,r)=>{t&&(e.round={state:"over",reason:r})},Wr=e=>{for(;e.inputChanges.length>0;){const t=e.inputChanges.shift(),r=U(e,t.entityId,t.type);if(!r)throw new Error;if(r.parentType==="sliderInput")r.value=W(t.value,r.min,r.max);else if(r.type==="targeter")r.targetEntityId=t.value;else if(r.type==="sword")r.swinging=!0;else if(r.type==="shield")r.blocking=!0;else throw new Error(`Unhandled input type '${t.type}'`);q(e,"debug",`Updated ${t.type} to value ${t.value}`)}e.round.state==="occurring"&&e.components.forEach(t=>{switch(t.parentType){case"resource":{switch(t.type){case"autopistol":{if(t.value<t.costPerShot)break;t.value=t.value-t.costPerShot;const r=U(e,t.entityId,"targeter");if(r.targetEntityId===null)break;const n=U(e,r.targetEntityId,"health");if(n.value===null)break;n.value=W(n.value-t.powerPerShot,n.min,n.max),lt(e,n.value<=0,"player lost :(")}break;case"hackingModule":{if(U(e,t.entityId,"hackingToggle").value===0)break;const n=U(e,t.entityId,"battery");if(n.value<t.chargeCost||(n.value=W(n.value-t.chargeCost,n.min,n.max),t.value=W(t.value+t.progressPerCharge,t.min,t.max),t.value<t.max))break;t.value=t.min;let a=!1;const s=U(e,t.entityId,"targeter");if(s.targetEntityId===null)break;if(t.phase==="attempting to disable")if(t.targetedComponentType===null)q(e,"debug","hacking module target was null when attempting to disable"),t.phase="scanning components";else{const o=U(e,s.targetEntityId,t.targetedComponentType);if(!o)q(e,"debug","hacking module target was unavailable when attempting to disable"),t.phase="scanning components";else{const v=Math.random()>t.successChance;switch(o.parentType){case"sliderInput":case"resource":if(v){const _=o.max-o.min,C=o.value;o.value=W(o.value-Math.ceil(_/t.resourceLossRatio),o.min,o.max);const S=o.value;q(e,"debug",`Successfully hacked (${C}->${S}) module type '${o.type}'`)}else q(e,"debug",`Failed to hack module type '${o.type}'`);t.phase="scanning components",t.targetedComponentType=null,a=!0;break;default:q(e,"debug",`hacking module target type '${o.type}' unhackable`),t.phase="scanning components",t.targetedComponentType=null;break}}}if(t.phase==="scanning components"&&!a){const o=e.components.filter(_=>_.entityId===s.targetEntityId&&(_.parentType==="resource"||_.parentType==="sliderInput"));t.targetedComponentType=Nr(o).type;const v=De(e,s.targetEntityId);t.phase="attempting to disable",q(e,"debug",`hacking module targeted ${v.debug}'s '${t.targetedComponentType}'`),a=!0}a||q(e,"debug","hacking module did nothing")}break}t.value=W(t.value+t.velocity,t.min,t.max)}break;case"sliderInput":switch(t.type){case"taser":{if(t.value<=0)break;const a=U(e,t.entityId,"battery"),s=a.value;if(a.value==null)break;a.value=W(a.value-t.batteryCostRatio*t.value,a.min,a.max);const o=s-a.value,v=U(e,t.entityId,"targeter");if(v.targetEntityId===null)break;const _=U(e,v.targetEntityId,"health");if(_.value===null)break;_.value=W(_.value-o**t.damageScaleExponent,_.min,_.max),lt(e,_.value<=0,De(e,t.entityId).debug+" won!")}break;case"generator":const r=U(e,t.entityId,"fuel"),n=U(e,t.entityId,"battery");for(let a=0;a<t.value;a++){if(r.value<t.fuelCost)return;r.value=W(r.value-t.fuelCost,r.min,r.max),n.value=W(n.value+t.batteryGenerationAmount*(a+1)**t.chargeExponent,n.min,n.max)}break}break;case"unique":switch(t.type){case"sword":{if(t.value=W(t.value+t.velocity,t.min,t.max),!t.swinging)break;if(t.swinging=!1,t.value<t.max){q(e,"debug","Swing attempted before sword was ready");break}const r=U(e,t.entityId,"fuel");if(r.value<t.costPerSwing){q(e,"debug","Swing attempted before fuel cost satisfied");break}const n=U(e,t.entityId,"targeter");if(n.targetEntityId===null){q(e,"debug","Swing attempted but no target");break}r.value-=t.costPerSwing,t.value=t.min;const a=U(e,n.targetEntityId,"health");if(a.value===null)break;a.value=W(a.value-t.baseDamage,a.min,a.max),lt(e,a.value<=0,De(e,t.entityId).debug+" won!")}break;case"shield":{if(t.value=W(t.value+t.velocity,t.min,t.max),!t.blocking)break;if(t.blocking=!1,t.value<t.max){q(e,"debug","Block attempted before shield was ready");break}const r=U(e,t.entityId,"fuel");if(r.value<t.costPer){q(e,"debug","Block attempted before fuel cost satisfied");break}if(t.numUses<=0){q(e,"debug","Block attempted but no remaining uses");break}r.value-=t.costPer,t.value=t.min,t.numUses--,q(e,"debug","Blocked (BLOCKING NOT YET IMPLEMENTED)")}break}}})},Yr=(e,t)=>{e.optimistic={...e.components},Object.entries(e.optimistic).forEach(([r,n])=>{const{parentType:a}=n;switch(a){case"resource":n.value=W(n.value+n.velocity*t,n.min,n.max);break}})};var Zr=z('<meter style="will-change: contents;"> </meter>');function he(e,t){const r=D(()=>t.component.min),n=D(()=>t.component.max),a=D(()=>t.component.value);let s=D(()=>i(n)-i(r));var o=Zr(),v=f(o);u(o),O(()=>{Be(o,"min",i(r)),Be(o,"low",i(s)/2.5+i(r)),Be(o,"high",i(s)*99/100+i(r)),Be(o,"optimum",i(s)*99.9/100+i(r)),Be(o,"max",i(n)),Fr(o,i(a)),F(v,`${i(a)??""} of ${i(n)??""}`)}),g(e,o)}var Wt=Symbol.for("immer-nothing"),St=Symbol.for("immer-draftable"),oe=Symbol.for("immer-state");function pe(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Ne=Object.getPrototypeOf;function Le(e){return!!e&&!!e[oe]}function Fe(e){var t;return e?Yt(e)||Array.isArray(e)||!!e[St]||!!((t=e.constructor)!=null&&t[St])||je(e)||Je(e):!1}var Xr=Object.prototype.constructor.toString();function Yt(e){if(!e||typeof e!="object")return!1;const t=Ne(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Xr}function Ye(e,t){Qe(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function Qe(e){const t=e[oe];return t?t.type_:Array.isArray(e)?1:je(e)?2:Je(e)?3:0}function vt(e,t){return Qe(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Zt(e,t,r){const n=Qe(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Qr(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function je(e){return e instanceof Map}function Je(e){return e instanceof Set}function Te(e){return e.copy_||e.base_}function pt(e,t){if(je(e))return new Map(e);if(Je(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Yt(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[oe];let a=Reflect.ownKeys(n);for(let s=0;s<a.length;s++){const o=a[s],v=n[o];v.writable===!1&&(v.writable=!0,v.configurable=!0),(v.get||v.set)&&(n[o]={configurable:!0,writable:!0,enumerable:v.enumerable,value:e[o]})}return Object.create(Ne(e),n)}else{const n=Ne(e);if(n!==null&&r)return{...e};const a=Object.create(n);return Object.assign(a,e)}}function ht(e,t=!1){return Ve(e)||Le(e)||!Fe(e)||(Qe(e)>1&&(e.set=e.add=e.clear=e.delete=jr),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>ht(n,!0))),e}function jr(){pe(2)}function Ve(e){return Object.isFrozen(e)}var Jr={};function ze(e){const t=Jr[e];return t||pe(0,e),t}var qe;function Xt(){return qe}function Vr(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Tt(e,t){t&&(ze("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function _t(e){mt(e),e.drafts_.forEach(en),e.drafts_=null}function mt(e){e===qe&&(qe=e.parent_)}function Ft(e){return qe=Vr(qe,e)}function en(e){const t=e[oe];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function zt(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[oe].modified_&&(_t(t),pe(4)),Fe(e)&&(e=Ze(t,e),t.parent_||Xe(t,e)),t.patches_&&ze("Patches").generateReplacementPatches_(r[oe].base_,e,t.patches_,t.inversePatches_)):e=Ze(t,r,[]),_t(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Wt?e:void 0}function Ze(e,t,r){if(Ve(t))return t;const n=t[oe];if(!n)return Ye(t,(a,s)=>At(e,n,t,a,s,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return Xe(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const a=n.copy_;let s=a,o=!1;n.type_===3&&(s=new Set(a),a.clear(),o=!0),Ye(s,(v,_)=>At(e,n,a,v,_,r,o)),Xe(e,a,!1),r&&e.patches_&&ze("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function At(e,t,r,n,a,s,o){if(Le(a)){const v=s&&t&&t.type_!==3&&!vt(t.assigned_,n)?s.concat(n):void 0,_=Ze(e,a,v);if(Zt(r,n,_),Le(_))e.canAutoFreeze_=!1;else return}else o&&r.add(a);if(Fe(a)&&!Ve(a)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ze(e,a),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&Xe(e,a)}}function Xe(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ht(t,r)}function tn(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Xt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=n,s=bt;r&&(a=[n],s=Ge);const{revoke:o,proxy:v}=Proxy.revocable(a,s);return n.draft_=v,n.revoke_=o,v}var bt={get(e,t){if(t===oe)return e;const r=Te(e);if(!vt(r,t))return rn(e,r,t);const n=r[t];return e.finalized_||!Fe(n)?n:n===ut(e.base_,t)?(ct(e),e.copy_[t]=gt(n,e)):n},has(e,t){return t in Te(e)},ownKeys(e){return Reflect.ownKeys(Te(e))},set(e,t,r){const n=Qt(Te(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const a=ut(Te(e),t),s=a==null?void 0:a[oe];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Qr(r,a)&&(r!==void 0||vt(e.base_,t)))return!0;ct(e),yt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ut(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ct(e),yt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=Te(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){pe(11)},getPrototypeOf(e){return Ne(e.base_)},setPrototypeOf(){pe(12)}},Ge={};Ye(bt,(e,t)=>{Ge[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ge.deleteProperty=function(e,t){return Ge.set.call(this,e,t,void 0)};Ge.set=function(e,t,r){return bt.set.call(this,e[0],t,r,e[0])};function ut(e,t){const r=e[oe];return(r?Te(r):e)[t]}function rn(e,t,r){var a;const n=Qt(t,r);return n?"value"in n?n.value:(a=n.get)==null?void 0:a.call(e.draft_):void 0}function Qt(e,t){if(!(t in e))return;let r=Ne(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Ne(r)}}function yt(e){e.modified_||(e.modified_=!0,e.parent_&&yt(e.parent_))}function ct(e){e.copy_||(e.copy_=pt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var nn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const s=r;r=t;const o=this;return function(_=s,...C){return o.produce(_,S=>r.call(this,S,...C))}}typeof r!="function"&&pe(6),n!==void 0&&typeof n!="function"&&pe(7);let a;if(Fe(t)){const s=Ft(this),o=gt(t,void 0);let v=!0;try{a=r(o),v=!1}finally{v?_t(s):mt(s)}return Tt(s,n),zt(a,s)}else if(!t||typeof t!="object"){if(a=r(t),a===void 0&&(a=t),a===Wt&&(a=void 0),this.autoFreeze_&&ht(a,!0),n){const s=[],o=[];ze("Patches").generateReplacementPatches_(t,a,s,o),n(s,o)}return a}else pe(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...v)=>this.produceWithPatches(o,_=>t(_,...v));let n,a;return[this.produce(t,r,(o,v)=>{n=o,a=v}),n,a]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Fe(e)||pe(8),Le(e)&&(e=an(e));const t=Ft(this),r=gt(e,void 0);return r[oe].isManual_=!0,mt(t),r}finishDraft(e,t){const r=e&&e[oe];(!r||!r.isManual_)&&pe(9);const{scope_:n}=r;return Tt(n,t),zt(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const a=t[r];if(a.path.length===0&&a.op==="replace"){e=a.value;break}}r>-1&&(t=t.slice(r+1));const n=ze("Patches").applyPatches_;return Le(e)?n(e,t):this.produce(e,a=>n(a,t))}};function gt(e,t){const r=je(e)?ze("MapSet").proxyMap_(e,t):Je(e)?ze("MapSet").proxySet_(e,t):tn(e,t);return(t?t.scope_:Xt()).drafts_.push(r),r}function an(e){return Le(e)||pe(10,e),jt(e)}function jt(e){if(!Fe(e)||Ve(e))return e;const t=e[oe];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=pt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=pt(e,!0);return Ye(r,(n,a)=>{Zt(r,n,jt(a))}),t&&(t.finalized_=!1),r}var se=new nn,We=se.produce;se.produceWithPatches.bind(se);se.setAutoFreeze.bind(se);se.setUseStrictShallowCopy.bind(se);se.applyPatches.bind(se);se.createDraft.bind(se);se.finishDraft.bind(se);const Oe=(e,t=ft)=>{var r=_n(),n=f(r);$t(n,t),u(r),g(e,r)},on=(e,t,r)=>{A(t,"inventory"),A(r,!1)},sn=(e,t,r)=>{A(t,"store"),A(r,!1)},ln=(e,t,r,n)=>{A(t,Gt(r)),A(n,!0)},Mt=(e,t,r)=>{A(t,"play"),A(r,!0)},dt=(e,t,r)=>{A(t,"entry"),A(r,!1)},Rt=(e,t)=>{A(t,We(i(t),r=>{Br(r)}))};var un=z("<label>Auto Pistol Cooldown <!></label>"),cn=z("<div> <!></div>"),dn=z("<div> </div> <div> </div> <div><!></div>",1),fn=z("<div> <!></div>"),vn=z('<div>Sword</div> <label style="display: block;">Cooldown <!></label> <label style="display: block;">Fuel cost <!></label> <button style="border-radius: 9999px; border: 4px inset tomato; background-color: tomato; padding: 1em; display: block; aspect-ratio:1;">Swing</button>',1),pn=z('<div>Shield</div> <label style="display: block;">Cooldown <!></label> <label style="display: block;">Fuel cost <!></label> <label style="display:block;"> <!></label> <button style="border-radius: 9999px; border: 4px inset lightsteelblue; background-color: lightsteelblue; padding: 1em; display: block; aspect-ratio:1;">Block</button>',1),_n=z('<div style="padding: 1em; border: 2px outset;"><!></div>'),mn=z('<div style="width:100%;height: 100%; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding-bottom: 4em;"><h1 class="svelte-2s92ts">Welcome</h1> <div><a href="?">Play</a></div> <div><a href="?">Shop</a></div> <div><a href="?">Inventory</a></div> <div><a href="/design">Design notes</a></div></div>'),yn=z('<p><a href="?">Begin</a></p>'),gn=z('<p>Paused. <a href="?">Unpause</a></p>'),hn=z('<div style="max-width: 60rem; min-width:40rem; height: 100%; margin: auto;"><!> <div style="border:4px inset; border-radius: 1em; padding: 2em; margin: 2em;"><h2 class="svelte-2s92ts">Enemy</h2> <div style="display: grid; grid-template-columns: 1fr 1fr;"><!> <!></div></div> <h2 class="svelte-2s92ts">Player</h2> <div style="display: grid; grid-template-columns: 1fr 1fr;"><!> <!> <!> <!></div></div>'),bn=z('<h2 class="svelte-2s92ts">Game over</h2> <p> </p>',1),kn=z('<a href="?">Toggle Fullscreen</a>'),wn=z('<!> <nav><a href="?">Restart</a> <a href="?">Back To Title</a> <!> <a href="?"> </a></nav>',1),xn=z('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div></div>'),Pn=z('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div></div>'),En=z(`<h2 class="svelte-2s92ts"> </h2> <p style="padding-inline: 4em">This is your inventory where you can see your current parts. You can also rearrange your
        parts to maximize their effectiveness</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <h2 class="svelte-2s92ts"> </h2> <p style="padding-inline: 4em">This is your enemy's inventory. Do you see what you're up against?</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <nav><a href="?">Back To Round</a> <a href="?">Back To Title</a></nav>`,1),In=(e,t,r)=>t(i(r)),Cn=z('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div> <button>Sell</button></div>'),Sn=z('<h2 class="svelte-2s92ts">The Shop</h2> <p style="padding-inline: 4em">Buy more stuff here.</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <nav><a href="?">Back To Round</a> <a href="?">Back To Title</a></nav>',1),Tn=z('<div style="width:100%;height: 100%; display: flex; flex-direction: column; gap:2em;"><!></div>');function Dn(e,t){Lt(t,!0);const r=b=>{var w=ve();const c=D(()=>Me(i(l),m,"autopistol"));var x=L(w);{var G=k=>{},B=k=>{var y=un(),I=d(f(y));he(I,{get component(){return i(c)}}),u(y),g(k,y)};K(x,k=>{i(c)?k(B,!1):k(G)})}g(b,w)},n=b=>{var w=ve();const c=D(()=>Me(i(l),m,"health"));var x=L(w);{var G=k=>{},B=k=>{var y=cn(),I=f(y);O(()=>F(I,`Health ${i(c).formatter(i(c).value)??""}/${i(c).max??""} `));var R=d(I);he(R,{get component(){return i(c)}}),u(y),g(k,y)};K(x,k=>{i(c)?k(B,!1):k(G)})}g(b,w)},a=b=>{var w=ve();const c=D(()=>Me(i(l),h,"health"));var x=L(w);{var G=k=>{},B=k=>{var y=dn(),I=L(y),R=f(I,!0);u(I);var de=d(I,2),Z=f(de);O(()=>F(Z,`${i(c).formatter(i(c).value)??""}/${i(c).max??""}`)),u(de);var X=d(de,2),J=f(X);he(J,{get component(){return i(c)}}),u(X),O(()=>F(R,i(c).type)),g(k,y)};K(x,k=>{i(c)?k(B,!1):k(G)})}g(b,w)},s=b=>{var w=ve();const c=D(()=>Me(i(l),h,"fuel"));var x=L(w);{var G=k=>{},B=k=>{var y=fn(),I=f(y);O(()=>F(I,`Fuel ${i(c).formatter(i(c).value)??""}/${i(c).max??""} `));var R=d(I);he(R,{get component(){return i(c)}}),u(y),g(k,y)};K(x,k=>{i(c)?k(B,!1):k(G)})}g(b,w)},o=b=>{var w=ve();const c=D(()=>Me(i(l),h,"sword")),x=D(()=>U(i(l),h,"fuel"));var G=L(w);{var B=y=>{},k=y=>{var I=vn(),R=d(L(I),2),de=d(f(R));he(de,{get component(){return i(c)}}),u(R);var Z=d(R,2),X=d(f(Z)),J=D(()=>({min:i(x).min,max:i(c).costPerSwing,value:W(i(x).value,i(x).min,i(c).costPerSwing)}));he(X,{get component(){return i(J)}}),u(Z);var ne=d(Z,2),be=D(()=>C(i(c).type));ne.__click=function(...Ce){var V;(V=i(be))==null||V.apply(this,Ce)},O(()=>ne.disabled=i(c).swinging),g(y,I)};K(G,y=>{i(c)?y(k,!1):y(B)})}g(b,w)},v=b=>{var w=ve();const c=D(()=>Me(i(l),h,"shield")),x=D(()=>U(i(l),h,"fuel"));var G=L(w);{var B=y=>{},k=y=>{var I=pn(),R=d(L(I),2),de=d(f(R));he(de,{get component(){return i(c)}}),u(R);var Z=d(R,2),X=d(f(Z)),J=D(()=>({min:i(x).min,max:i(c).costPer,value:W(i(x).value,i(x).min,i(c).costPer)}));he(X,{get component(){return i(J)}}),u(Z);var ne=d(Z,2),be=f(ne),Ce=d(be),V=D(()=>({min:0,max:i(c).totalUses,value:i(c).numUses}));he(Ce,{get component(){return i(V)}}),u(ne);var fe=d(ne,2),_e=D(()=>C(i(c).type));fe.__click=function(...ke){var le;(le=i(_e))==null||le.apply(this,ke)},O(()=>{F(be,`${i(c).numUses??""}/${i(c).totalUses??""} `),fe.disabled=i(c).blocking}),g(y,I)};K(G,y=>{i(c)?y(k,!1):y(B)})}g(b,w)},_=(b,w=ft,c=ft)=>{var x=Tn(),G=f(x);{var B=y=>{var I=mn(),R=d(f(I),2),de=f(R);de.__click=Y,u(R);var Z=d(R,2),X=f(Z);X.__click=[sn,T,P],u(Z);var J=d(Z,2),ne=f(J);ne.__click=[on,T,P],u(J),xr(2),u(I),g(y,I)},k=y=>{var I=ve(),R=L(I);{var de=X=>{var J=wn(),ne=L(J);{var be=$=>{var Q=yn(),ye=f(Q);ye.__click=Y,u(Q),g($,Q)},Ce=$=>{var Q=ve(),ye=L(Q);{var ge=M=>{var N=hn(),H=f(N);{var ae=et=>{var tt=gn(),Vt=d(f(tt));Vt.__click=[Rt,l],u(tt),g(et,tt)};K(H,et=>{i(l).round.state==="paused"&&et(ae)})}var ee=d(H,2),ie=d(f(ee),2),te=f(ie);Oe(te,()=>n);var re=d(te,2);Oe(re,()=>r),u(ie),u(ee);var ue=d(ee,4),ce=f(ue);Oe(ce,()=>a);var we=d(ce,2);Oe(we,()=>s);var kt=d(we,2);Oe(kt,()=>o);var Jt=d(kt,2);Oe(Jt,()=>v),u(ue),u(N),g(M,N)},j=M=>{var N=ve(),H=L(N);{var ae=ee=>{var ie=bn(),te=d(L(ie),2),re=f(te);u(te),O(()=>F(re,`Reason: ${i(l).round.reason??""}`)),g(ee,ie)};K(H,ee=>{i(l).round.state==="over"&&ee(ae)},!0)}g(M,N)};K(ye,M=>{i(l).round.state==="occurring"||i(l).round.state==="paused"?M(ge):M(j,!1)},!0)}g($,Q)};K(ne,$=>{i(l).round.state==="not yet started"?$(be):$(Ce,!1)})}var V=d(ne,2),fe=f(V);fe.__click=[ln,l,p,P];var _e=d(fe,2);_e.__click=[dt,T,P];var ke=d(_e,2);{var le=$=>{var Q=kn();Q.__click=function(...ye){var ge;(ge=c())==null||ge.apply(this,ye)},g($,Q)};K(ke,$=>{w()&&$(le)})}var me=d(ke,2);me.__click=[Rt,l];var Se=f(me,!0);u(me),u(V),O(()=>F(Se,i(E)?"Unpause (Paused)":"Pause")),g(X,J)},Z=X=>{var J=ve(),ne=L(J);{var be=V=>{var fe=En(),_e=L(fe),ke=f(_e);O(()=>F(ke,`${De(i(l),h).debug??""}'s Inventory`)),u(_e);var le=d(_e,4);it(le,21,()=>i(l).parts.filter(({entityId:j})=>j===h),at,(j,M)=>{var N=xn(),H=f(N),ae=f(H),ee=f(ae,!0);u(ae);var ie=d(ae,2),te=f(ie,!0);u(ie),u(H);var re=d(H,2);Ae(re,"font-size","0.8em");var ue=f(re),ce=d(ue);Ae(ce,"font-size","0.8em");var we=f(ce,!0);O(()=>F(we,i(M).components.join(" "))),u(ce),u(re),u(N),O(()=>{F(ee,i(M).title),F(te,i(M).description),F(ue,`${i(M).type??""} `)}),g(j,N)}),u(le);var me=d(le,2),Se=f(me);O(()=>F(Se,`${De(i(l),m).debug??""}'s Inventory`)),u(me);var $=d(me,4);it($,21,()=>i(l).parts.filter(({entityId:j})=>j===m),at,(j,M)=>{var N=Pn(),H=f(N),ae=f(H),ee=f(ae,!0);u(ae);var ie=d(ae,2),te=f(ie,!0);u(ie),u(H);var re=d(H,2);Ae(re,"font-size","0.8em");var ue=f(re),ce=d(ue);Ae(ce,"font-size","0.8em");var we=f(ce,!0);O(()=>F(we,i(M).components.join(" "))),u(ce),u(re),u(N),O(()=>{F(ee,i(M).title),F(te,i(M).description),F(ue,`${i(M).type??""} `)}),g(j,N)}),u($);var Q=d($,2),ye=f(Q);ye.__click=[Mt,T,P];var ge=d(ye,2);ge.__click=[dt,T,P],u(Q),g(V,fe)},Ce=V=>{var fe=ve(),_e=L(fe);{var ke=le=>{var me=Sn(),Se=d(L(me),4);it(Se,21,()=>i(l).parts.filter(({entityId:ge})=>ge===h),at,(ge,j)=>{var M=Cn(),N=f(M),H=f(N),ae=f(H,!0);u(H);var ee=d(H,2),ie=f(ee,!0);u(ee),u(N);var te=d(N,2);Ae(te,"font-size","0.8em");var re=f(te),ue=d(re);Ae(ue,"font-size","0.8em");var ce=f(ue,!0);O(()=>F(ce,i(j).components.join(" "))),u(ue),u(te);var we=d(te,2);we.__click=[In,S,j],u(M),O(()=>{F(ae,i(j).title),F(ie,i(j).description),F(re,`${i(j).type??""} `)}),g(ge,M)}),u(Se);var $=d(Se,2),Q=f($);Q.__click=[Mt,T,P];var ye=d(Q,2);ye.__click=[dt,T,P],u($),g(le,me)};K(_e,le=>{i(T)==="store"&&le(ke)},!0)}g(V,fe)};K(ne,V=>{i(T)==="inventory"?V(be):V(Ce,!1)},!0)}g(X,J)};K(R,X=>{i(T)==="play"?X(de):X(Z,!1)},!0)}g(y,I)};K(G,y=>{i(T)==="entry"?y(B):y(k,!1)})}u(x),g(b,x)},C=b=>w=>{A(l,We(i(l),c=>{st(c,{entityId:h,type:b,value:"buttonPressed",time:Ie()})}))},S=b=>{A(l,We(i(l),w=>{Gr(w,b.entityId,b.type)}))},p=$r(),h=Ct(p,"Player");Re(p,h,"core"),Re(p,h,"sword"),Re(p,h,"shield");const m=Ct(p,"Enemy");Re(p,m,"core"),Re(p,m,"autopistol"),Re(p,m,"bipedalLegs"),st(p,{entityId:h,type:"targeter",value:m,time:Ie()}),st(p,{entityId:m,type:"targeter",value:h,time:Ie()});let l=Ee(p),P=Ee(!1);wr(()=>{let b=!1;const w=()=>{i(P)&&A(l,We(i(l),c=>{Kr(c)})),b||requestAnimationFrame(w)};return requestAnimationFrame(w),()=>{b=!0}});let T=Ee("entry");const Y=()=>{A(T,"play"),A(l,Gt(p)),A(P,!0)};Y();const E=D(()=>i(l).round.state==="paused");Or(e,{fullscreenable:_}),Ut()}Bt(["click"]);export{Dn as component};
