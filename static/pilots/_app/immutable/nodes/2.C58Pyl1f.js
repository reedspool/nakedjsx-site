import{a as g,t as F,c as ve}from"../chunks/disclose-version.CLXa-AFD.js";import{h as Pe,C as st,Q as nr,a0 as ar,A as or,b as ir,z as sr,_ as Lt,H as lr,B as Pt,D as lt,c as Be,W as ur,as as Ye,F as Nt,a as Bt,G as cr,w as Et,at as dr,au as fr,Z as vr,av as pr,d as mr,O as _r,an as yr,s as Ct,aw as gr,ax as hr,ay as br,T as kr,az as wr,y as xr,aA as Pr,p as qt,a6 as U,i as jt,r as T,v as o,ar as Ce,a7 as f,a9 as u,a8 as c,a5 as L,u as Er,n as Ze,e as Cr,g as B}from"../chunks/runtime.Bm73Tpmf.js";import{d as Gt,s as M}from"../chunks/render.BfQ3xYTj.js";import{i as $,b as Ir,p as It}from"../chunks/this.CnBV6IW7.js";import{s as Ht}from"../chunks/snippet.Cwy7Ud8A.js";import{o as Sr}from"../chunks/index-client.B3YRV3HL.js";function ut(e,t){return t}function Tr(e,t,r,n){for(var a=[],s=t.length,i=0;i<s;i++)fr(t[i].e,a,!0);var d=s>0&&a.length===0&&r!==null;if(d){var h=r.parentNode;vr(h),h.append(r),n.clear(),Ee(e,t[0].prev,t[s-1].next)}pr(a,()=>{for(var E=0;E<s;E++){var A=t[E];d||(n.delete(A.k),Ee(e,A.prev,A.next)),mr(A.e,!d)}})}function ct(e,t,r,n,a,s=null){var i=e,d={flags:t,items:new Map,first:null};{var h=e;i=Pe?st(nr(h)):h.appendChild(ar())}Pe&&or();var E=null,A=!1;ir(()=>{var p=r(),b=sr(p)?p:p==null?[]:Lt(p),y=b.length;if(A&&y===0)return;A=y===0;let l=!1;if(Pe){var x=i.data===lr;x!==(y===0)&&(i=Pt(),st(i),lt(!1),l=!0)}if(Pe){for(var C=null,te,m=0;m<y;m++){if(Be.nodeType===8&&Be.data===ur){i=Be,l=!0,lt(!1);break}var _=b[m],v=n(_,m);te=Kt(Be,d,C,null,_,v,m,a,t),d.items.set(v,te),C=te}y>0&&st(Pt())}if(!Pe){var I=_r;Fr(b,d,i,a,t,(I.f&Ye)!==0,n)}s!==null&&(y===0?E?Nt(E):E=Bt(()=>s(i)):E!==null&&cr(E,()=>{E=null})),l&&lt(!0),r()}),Pe&&(i=Be)}function Fr(e,t,r,n,a,s,i,d){var h=e.length,E=t.items,A=t.first,p=A,b,y=null,l=[],x=[],C,te,m,_;for(_=0;_<h;_+=1){if(C=e[_],te=i(C,_),m=E.get(te),m===void 0){var v=p?p.e.nodes_start:r;y=Kt(v,t,y,y===null?t.first:y.next,C,te,_,n,a),E.set(te,y),l=[],x=[],p=y.next;continue}if(Ar(m,C,_),m.e.f&Ye&&Nt(m.e),m!==p){if(b!==void 0&&b.has(m)){if(l.length<x.length){var I=x[0],S;y=I.prev;var D=l[0],k=l[l.length-1];for(S=0;S<l.length;S+=1)St(l[S],I,r);for(S=0;S<x.length;S+=1)b.delete(x[S]);Ee(t,D.prev,k.next),Ee(t,y,D),Ee(t,k,I),p=I,y=k,_-=1,l=[],x=[]}else b.delete(m),St(m,p,r),Ee(t,m.prev,m.next),Ee(t,m,y===null?t.first:y.next),Ee(t,y,m),y=m;continue}for(l=[],x=[];p!==null&&p.k!==te;)(s||!(p.e.f&Ye))&&(b??(b=new Set)).add(p),x.push(p),p=p.next;if(p===null)continue;m=p}l.push(m),y=m,p=m.next}if(p!==null||b!==void 0){for(var w=b===void 0?[]:Lt(b);p!==null;)(s||!(p.e.f&Ye))&&w.push(p),p=p.next;var R=w.length;if(R>0){var P=h===0?r:null;Tr(t,w,P,E)}}Et.first=t.first&&t.first.e,Et.last=y&&y.e}function Ar(e,t,r,n){dr(e.v,t),e.i=r}function Kt(e,t,r,n,a,s,i,d,h,E){var A=(h&hr)!==0,p=(h&br)===0,b=A?p?yr(a):Ct(a):a,y=h&gr?Ct(i):i,l={i:y,v:b,k:s,a:null,e:null,prev:r,next:n};try{return l.e=Bt(()=>d(e,b,y),Pe),l.e.prev=r&&r.e,l.e.next=n&&n.e,r===null?t.first=l:(r.next=l,r.e.next=l.e),n!==null&&(n.prev=l,n.e.prev=l.e),l}finally{}}function St(e,t,r){for(var n=e.next?e.next.e.nodes_start:r,a=t?t.e.nodes_start:r,s=e.e.nodes_start;s!==n;){var i=kr(s);a.before(s),s=i}}function Ee(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function zr(e,t){var r=e.__attributes??(e.__attributes={});r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t)}function qe(e,t,r,n){var a=e.__attributes??(e.__attributes={});Pe&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[wr]=r),r==null?e.removeAttribute(t):typeof r!="string"&&Mr(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var Tt=new Map;function Mr(e){var t=Tt.get(e.nodeName);if(t)return t;Tt.set(e.nodeName,t=[]);for(var r,n=e,a=Element.prototype;a!==n;){r=Pr(n);for(var s in r)r[s].set&&t.push(s);n=xr(n)}return t}function Rr(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function De(e,t,r,n){var a=e.__styles??(e.__styles={});a[t]!==r&&(a[t]=r,e.style.setProperty(t,r,""))}var Dr=F('<button class="svelte-9gqnah"><i class="material-icons md-36 svelte-9gqnah"> </i></button>'),Or=F('<div class="svelte-9gqnah"><!> <!></div>');function $r(e,t){qt(t,!0);let r=Ce(!1),n=Ce(null);const a=()=>{};let s=Ce(a),i=Ce(a),d=Ce(!1);Sr(()=>{T(i,()=>{(o(n).requestFullscreen||o(n).mozRequestFullScreen||o(n).webkitRequestFullscreen||o(n).msRequestFullscreen||a).bind(o(n))()}),T(s,It((document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen||a).bind(document))),T(d,!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach(x=>document.addEventListener(x,()=>{T(r,It(document.fullscreenElement)),console.log(`Fullscreen updated to ${o(r)?"ON":"OFF"}`)},!1));const l=document.createElement("link");return l.rel="stylesheet",l.href="https://fonts.googleapis.com/icon?family=Material+Icons",document.head.appendChild(l),()=>{l.parentNode.removeChild(l)}});const h=()=>{if(o(d)){if(o(r)&&!document.fullscreenElement){console.error("Fullscreen was out of sync"),T(r,!1);return}o(r)?o(s)():o(i)(o(n)),T(r,!o(r))}};let E=L(()=>o(r)?"fullscreen_exit":"fullscreen");var A=Or(),p=f(A);Ht(p,()=>t.fullscreenable,()=>o(d),()=>o(r),()=>h);var b=u(p,2);{var y=l=>{var x=Dr();x.__click=h;var C=f(x),te=f(C,!0);c(C),c(x),U(()=>M(te,o(E))),g(l,x)};$(b,l=>{!t.fullscreenable&&o(d)&&l(y)})}c(A),Ir(A,l=>T(n,l),()=>o(n)),U(()=>Rr(A,"isFull",o(r))),g(e,A),jt()}Gt(["click"]);const Ur=e=>Math.floor(Math.random()*e),Lr=e=>e[Ur(e.length)],ee=(e,t,r)=>Math.min(r,Math.max(e,t)),Xe=25,Nr={core:{type:"core",components:["targeter","health"],title:"Core",description:"Processing, control, mechanical center"},bipedalLegs:{type:"bipedalLegs",components:["fuel","stance"],title:"Legs",description:"Stand, shift, and shuffle on two feet"},autopistol:{type:"autopistol",components:["autopistol","targeter"],title:"Gun",description:"Chk chk boom"},sword:{type:"sword",components:["sword","targeter","fuel"],title:"Sword",description:"Schwa-schwa-krang"},shield:{type:"shield",components:["shield","fuel"],title:"Shield",description:"A fancy name for a metal slab"},taser:{type:"taser",components:["targeter","taser","generator","battery"],title:"Taser",description:"Zzztt"},hackingModule:{type:"hackingModule",components:["targeter","hackingModule","hackingToggle","generator","battery"],title:"Taser",description:"Zzztt"}},je=()=>({parentType:"resource",min:0,max:100,value:100,velocity:0,formatter:e=>Math.trunc(e)}),We=()=>({parentType:"sliderInput",min:0,max:100,value:100,formatter:e=>Math.trunc(e)}),Br={fuel:{type:"fuel",...je(),velocity:1},battery:{type:"battery",...je(),max:1e3,value:200,velocity:-1},generator:{type:"generator",...We(),max:3,value:1,fuelCost:1,batteryGenerationAmount:1,chargeExponent:1.1},taser:{type:"taser",...We(),max:1,value:0,batteryCostRatio:16,damageScaleExponent:1e-4},health:{type:"health",...je()},autopistol:{type:"autopistol",...je(),max:3,costPerShot:3,powerPerShot:5,value:0,velocity:.01},sword:{type:"sword",parentType:"unique",costPerSwing:90,baseDamage:25,value:0,min:0,max:100,velocity:1,formatter:e=>Math.trunc(e),swinging:!1},shield:{type:"shield",parentType:"unique",costPer:90,value:0,min:0,max:100,velocity:1.6,totalUses:3,numUses:3,formatter:e=>Math.trunc(e),blocking:!1,blockedAt:null,blockDuration:Xe*10},stance:{type:"stance",...We(),min:-1,max:1,value:0},targeter:{type:"targeter",parentType:"unique",targetEntityId:null},hackingModule:{type:"hackingModule",...je(),value:0,max:100,velocity:0,progressPerCharge:1,chargeCost:16,phase:"scanning components",targetedComponentType:null,successChance:.8,resourceLossRatio:6},hackingToggle:{type:"hackingToggle",...We(),value:0,max:1}},q=(e,t,r)=>{e.log.push({timestamp:ge(),entry:r,level:t}),console.log("Log",e.log.at(-1))},qr=e=>{const t=e.round.state;if(t!=="occurring"&&t!=="paused"){console.error("Paused when round not playing");return}e.round=t==="occurring"?{state:"paused"}:{state:"occurring"}},jr=()=>{const e=ge();return{mostRecentUpdate:e,round:{state:"not yet started"},log:[],inputChanges:[],remainingLag:0,gameStartedTime:e,entities:[],components:[],parts:[],optimistic:[]}},Te=(e,t,r)=>{const n=e.components.find(a=>a.entityId===t&&a.type===r);if(n)return Zt(n,r)},K=(e,t,r)=>{const n=e.components.find(a=>a.entityId===t&&a.type===r);if(!n){const a=$e(e,t);throw new Error(`${r}' required for '${a==null?void 0:a.debug}' (${a==null?void 0:a.entityId})`)}return Zt(n,r)},$e=(e,t)=>{let r=e.entities.find(n=>n.entityId===t);return r||(r={debug:"Unknown entity",entityId:-1}),r},ge=()=>Math.trunc(performance.now()),Wt=e=>{const t=ge();return{...e,round:{state:"occurring"},log:[],gameStartedTime:t,mostRecentUpdate:t}};let Gr=0;const Ft=(e,t)=>{let r=Gr++;return e.entities.push({entityId:r,debug:t}),r},Ge=(e,t,r)=>{const n=Nr[r];e.parts.push({...n,entityId:t}),n.components.forEach(a=>{Yt(e,t,a)})},Hr=(e,t,r)=>{e.parts=e.parts.filter(n=>!(t===n.entityId&&r===n.type)),Kr(e,t)},Kr=(e,t)=>{e.components=e.components.filter(r=>r.entityId!==t),e.parts.filter(r=>r.entityId===t).forEach(r=>r.components.forEach(n=>{Yt(e,r.entityId,n)}))},Yt=(e,t,r)=>{{let n=Br[r];if(e.components.find(s=>s.entityId===t&&s.type==r))return;let a={...n,entityId:t};e.components.push(a)}};function Zt(e,t){if(!e)throw new Error;if(e.type!==t)throw Error(`expected tag ${t} but was ${e.type}`);return e}const dt=(e,t)=>{e.inputChanges.push(t)},Wr=e=>{const r=ge()-e.mostRecentUpdate;e.mostRecentUpdate=ge(),e.remainingLag+=r;let n=0;for(;e.remainingLag>=Xe;)if(Zr(e),n++,e.remainingLag-=Xe,n>100){q(e,"debug","Lag recovery spinout");break}n>1&&q(e,"debug",`Updated ${n} times to recover from lag`);const a=e.remainingLag/Xe;Xr(e,a)},Yr=(e,t,r)=>{t&&(e.round={state:"over",reason:r})},ft=(e,t,r,n)=>{const a=$e(e,t);let s="no memo";switch(n.type){case"attack":s=`damaged by ${$e(e,n.from).debug}'s ${n.with}`;break;case"self":s="self-damaged";break;default:throw new Error("Unknown attack type")}const i=Te(e,t,"shield");if(i&&i.blockedAt!==null&&i.blockedAt+i.blockDuration>=ge()){q(e,"debug",`${a.debug} almost '${r}' damage, ${s}, but BLOCKED IT!`),i.blockedAt=null;return}const d=K(e,t,"health");d.value=ee(d.value-r,d.min,d.max),q(e,"debug",`${a.debug} took '${r}' damage, ${s}`),Yr(e,d.value<=0,`${a.debug}'s health depleted`)},Zr=e=>{for(;e.inputChanges.length>0;){const t=e.inputChanges.shift(),r=K(e,t.entityId,t.type);if(!r)throw new Error;if(r.parentType==="sliderInput")r.value=ee(t.value,r.min,r.max);else if(r.type==="targeter")r.targetEntityId=t.value;else if(r.type==="sword")r.swinging=!0;else if(r.type==="shield")r.blocking=!0;else throw new Error(`Unhandled input type '${t.type}'`);q(e,"debug",`Updated ${t.type} to value ${t.value}`)}e.round.state==="occurring"&&e.components.forEach(t=>{switch(t.parentType){case"resource":{switch(t.type){case"autopistol":{if(t.value<t.costPerShot)break;t.value=t.value-t.costPerShot;const r=K(e,t.entityId,"targeter");if(r.targetEntityId===null)break;ft(e,r.targetEntityId,t.powerPerShot,{type:"attack",from:t.entityId,with:t.type})}break;case"hackingModule":{if(K(e,t.entityId,"hackingToggle").value===0)break;const n=K(e,t.entityId,"battery");if(n.value<t.chargeCost||(n.value=ee(n.value-t.chargeCost,n.min,n.max),t.value=ee(t.value+t.progressPerCharge,t.min,t.max),t.value<t.max))break;t.value=t.min;let a=!1;const s=K(e,t.entityId,"targeter");if(s.targetEntityId===null)break;if(t.phase==="attempting to disable")if(t.targetedComponentType===null)q(e,"debug","hacking module target was null when attempting to disable"),t.phase="scanning components";else{const i=K(e,s.targetEntityId,t.targetedComponentType);if(!i)q(e,"debug","hacking module target was unavailable when attempting to disable"),t.phase="scanning components";else{const d=Math.random()>t.successChance;switch(i.parentType){case"sliderInput":case"resource":if(d){const h=i.max-i.min,E=i.value;i.value=ee(i.value-Math.ceil(h/t.resourceLossRatio),i.min,i.max);const A=i.value;q(e,"debug",`Successfully hacked (${E}->${A}) module type '${i.type}'`)}else q(e,"debug",`Failed to hack module type '${i.type}'`);t.phase="scanning components",t.targetedComponentType=null,a=!0;break;default:q(e,"debug",`hacking module target type '${i.type}' unhackable`),t.phase="scanning components",t.targetedComponentType=null;break}}}if(t.phase==="scanning components"&&!a){const i=e.components.filter(h=>h.entityId===s.targetEntityId&&(h.parentType==="resource"||h.parentType==="sliderInput"));t.targetedComponentType=Lr(i).type;const d=$e(e,s.targetEntityId);t.phase="attempting to disable",q(e,"debug",`hacking module targeted ${d.debug}'s '${t.targetedComponentType}'`),a=!0}a||q(e,"debug","hacking module did nothing")}break}t.value=ee(t.value+t.velocity,t.min,t.max)}break;case"sliderInput":switch(t.type){case"taser":{if(t.value<=0)break;const a=K(e,t.entityId,"battery"),s=a.value;if(a.value==null)break;a.value=ee(a.value-t.batteryCostRatio*t.value,a.min,a.max);const i=s-a.value,d=K(e,t.entityId,"targeter");if(d.targetEntityId===null)break;ft(e,d.targetEntityId,i**t.damageScaleExponent,{type:"attack",from:t.entityId,with:t.type})}break;case"generator":const r=K(e,t.entityId,"fuel"),n=K(e,t.entityId,"battery");for(let a=0;a<t.value;a++){if(r.value<t.fuelCost)return;r.value=ee(r.value-t.fuelCost,r.min,r.max),n.value=ee(n.value+t.batteryGenerationAmount*(a+1)**t.chargeExponent,n.min,n.max)}break}break;case"unique":switch(t.type){case"sword":{if(t.value=ee(t.value+t.velocity,t.min,t.max),!t.swinging)break;if(t.swinging=!1,t.value<t.max){q(e,"debug","Swing attempted before sword was ready");break}const r=K(e,t.entityId,"fuel");if(r.value<t.costPerSwing){q(e,"debug","Swing attempted before fuel cost satisfied");break}const n=K(e,t.entityId,"targeter");if(n.targetEntityId===null){q(e,"debug","Swing attempted but no target");break}r.value-=t.costPerSwing,t.value=t.min,ft(e,n.targetEntityId,t.baseDamage,{type:"attack",from:t.entityId,with:t.type})}break;case"shield":{if(t.value=ee(t.value+t.velocity,t.min,t.max),!t.blocking)break;if(t.blocking=!1,t.value<t.max){q(e,"debug","Block attempted before shield was ready");break}const r=K(e,t.entityId,"fuel");if(r.value<t.costPer){q(e,"debug","Block attempted before fuel cost satisfied");break}if(t.numUses<=0){q(e,"debug","Block attempted but no remaining uses");break}r.value-=t.costPer,t.value=t.min,t.numUses--,t.blockedAt=ge()}break}}})},Xr=(e,t)=>{e.optimistic={...e.components},Object.entries(e.optimistic).forEach(([r,n])=>{const{parentType:a}=n;switch(a){case"resource":n.value=ee(n.value+n.velocity*t,n.min,n.max);break}})};var Qr=F('<meter style="will-change: contents;"> </meter>');function we(e,t){const r=L(()=>t.component.min),n=L(()=>t.component.max),a=L(()=>t.component.value);let s=L(()=>o(n)-o(r));var i=Qr(),d=f(i);c(i),U(()=>{qe(i,"min",o(r)),qe(i,"low",o(s)/2.5+o(r)),qe(i,"high",o(s)*99/100+o(r)),qe(i,"optimum",o(s)*99.9/100+o(r)),qe(i,"max",o(n)),zr(i,o(a)),M(d,`${o(a)??""} of ${o(n)??""}`)}),g(e,i)}var Xt=Symbol.for("immer-nothing"),At=Symbol.for("immer-draftable"),ae=Symbol.for("immer-state");function pe(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Ue=Object.getPrototypeOf;function Le(e){return!!e&&!!e[ae]}function Ae(e){var t;return e?Qt(e)||Array.isArray(e)||!!e[At]||!!((t=e.constructor)!=null&&t[At])||rt(e)||nt(e):!1}var Jr=Object.prototype.constructor.toString();function Qt(e){if(!e||typeof e!="object")return!1;const t=Ue(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Jr}function Je(e,t){tt(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function tt(e){const t=e[ae];return t?t.type_:Array.isArray(e)?1:rt(e)?2:nt(e)?3:0}function _t(e,t){return tt(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Jt(e,t,r){const n=tt(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Vr(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function rt(e){return e instanceof Map}function nt(e){return e instanceof Set}function Fe(e){return e.copy_||e.base_}function yt(e,t){if(rt(e))return new Map(e);if(nt(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Qt(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[ae];let a=Reflect.ownKeys(n);for(let s=0;s<a.length;s++){const i=a[s],d=n[i];d.writable===!1&&(d.writable=!0,d.configurable=!0),(d.get||d.set)&&(n[i]={configurable:!0,writable:!0,enumerable:d.enumerable,value:e[i]})}return Object.create(Ue(e),n)}else{const n=Ue(e);if(n!==null&&r)return{...e};const a=Object.create(n);return Object.assign(a,e)}}function wt(e,t=!1){return at(e)||Le(e)||!Ae(e)||(tt(e)>1&&(e.set=e.add=e.clear=e.delete=en),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>wt(n,!0))),e}function en(){pe(2)}function at(e){return Object.isFrozen(e)}var tn={};function ze(e){const t=tn[e];return t||pe(0,e),t}var He;function Vt(){return He}function rn(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function zt(e,t){t&&(ze("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function gt(e){ht(e),e.drafts_.forEach(nn),e.drafts_=null}function ht(e){e===He&&(He=e.parent_)}function Mt(e){return He=rn(He,e)}function nn(e){const t=e[ae];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Rt(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[ae].modified_&&(gt(t),pe(4)),Ae(e)&&(e=Ve(t,e),t.parent_||et(t,e)),t.patches_&&ze("Patches").generateReplacementPatches_(r[ae].base_,e,t.patches_,t.inversePatches_)):e=Ve(t,r,[]),gt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Xt?e:void 0}function Ve(e,t,r){if(at(t))return t;const n=t[ae];if(!n)return Je(t,(a,s)=>Dt(e,n,t,a,s,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return et(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const a=n.copy_;let s=a,i=!1;n.type_===3&&(s=new Set(a),a.clear(),i=!0),Je(s,(d,h)=>Dt(e,n,a,d,h,r,i)),et(e,a,!1),r&&e.patches_&&ze("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Dt(e,t,r,n,a,s,i){if(Le(a)){const d=s&&t&&t.type_!==3&&!_t(t.assigned_,n)?s.concat(n):void 0,h=Ve(e,a,d);if(Jt(r,n,h),Le(h))e.canAutoFreeze_=!1;else return}else i&&r.add(a);if(Ae(a)&&!at(a)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ve(e,a),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&et(e,a)}}function et(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&wt(t,r)}function an(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Vt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=n,s=xt;r&&(a=[n],s=Ke);const{revoke:i,proxy:d}=Proxy.revocable(a,s);return n.draft_=d,n.revoke_=i,d}var xt={get(e,t){if(t===ae)return e;const r=Fe(e);if(!_t(r,t))return on(e,r,t);const n=r[t];return e.finalized_||!Ae(n)?n:n===vt(e.base_,t)?(pt(e),e.copy_[t]=kt(n,e)):n},has(e,t){return t in Fe(e)},ownKeys(e){return Reflect.ownKeys(Fe(e))},set(e,t,r){const n=er(Fe(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const a=vt(Fe(e),t),s=a==null?void 0:a[ae];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Vr(r,a)&&(r!==void 0||_t(e.base_,t)))return!0;pt(e),bt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return vt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,pt(e),bt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=Fe(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){pe(11)},getPrototypeOf(e){return Ue(e.base_)},setPrototypeOf(){pe(12)}},Ke={};Je(xt,(e,t)=>{Ke[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ke.deleteProperty=function(e,t){return Ke.set.call(this,e,t,void 0)};Ke.set=function(e,t,r){return xt.set.call(this,e[0],t,r,e[0])};function vt(e,t){const r=e[ae];return(r?Fe(r):e)[t]}function on(e,t,r){var a;const n=er(t,r);return n?"value"in n?n.value:(a=n.get)==null?void 0:a.call(e.draft_):void 0}function er(e,t){if(!(t in e))return;let r=Ue(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Ue(r)}}function bt(e){e.modified_||(e.modified_=!0,e.parent_&&bt(e.parent_))}function pt(e){e.copy_||(e.copy_=yt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var sn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const s=r;r=t;const i=this;return function(h=s,...E){return i.produce(h,A=>r.call(this,A,...E))}}typeof r!="function"&&pe(6),n!==void 0&&typeof n!="function"&&pe(7);let a;if(Ae(t)){const s=Mt(this),i=kt(t,void 0);let d=!0;try{a=r(i),d=!1}finally{d?gt(s):ht(s)}return zt(s,n),Rt(a,s)}else if(!t||typeof t!="object"){if(a=r(t),a===void 0&&(a=t),a===Xt&&(a=void 0),this.autoFreeze_&&wt(a,!0),n){const s=[],i=[];ze("Patches").generateReplacementPatches_(t,a,s,i),n(s,i)}return a}else pe(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(i,...d)=>this.produceWithPatches(i,h=>t(h,...d));let n,a;return[this.produce(t,r,(i,d)=>{n=i,a=d}),n,a]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Ae(e)||pe(8),Le(e)&&(e=ln(e));const t=Mt(this),r=kt(e,void 0);return r[ae].isManual_=!0,ht(t),r}finishDraft(e,t){const r=e&&e[ae];(!r||!r.isManual_)&&pe(9);const{scope_:n}=r;return zt(n,t),Rt(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const a=t[r];if(a.path.length===0&&a.op==="replace"){e=a.value;break}}r>-1&&(t=t.slice(r+1));const n=ze("Patches").applyPatches_;return Le(e)?n(e,t):this.produce(e,a=>n(a,t))}};function kt(e,t){const r=rt(e)?ze("MapSet").proxyMap_(e,t):nt(e)?ze("MapSet").proxySet_(e,t):an(e,t);return(t?t.scope_:Vt()).drafts_.push(r),r}function ln(e){return Le(e)||pe(10,e),tr(e)}function tr(e){if(!Ae(e)||at(e))return e;const t=e[ae];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=yt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=yt(e,!0);return Je(r,(n,a)=>{Jt(r,n,tr(a))}),t&&(t.finalized_=!1),r}var oe=new sn,Qe=oe.produce;oe.produceWithPatches.bind(oe);oe.setAutoFreeze.bind(oe);oe.setUseStrictShallowCopy.bind(oe);oe.applyPatches.bind(oe);oe.createDraft.bind(oe);oe.finishDraft.bind(oe);const Oe=(e,t=Ze)=>{var r=gn(),n=f(r);Ht(n,t),c(r),g(e,r)},Ot=(e,t,r,n,a)=>{T(t,"play"),T(r,Wt(n)),T(a,!0)},un=(e,t,r)=>{T(t,"inventory"),T(r,!1)},cn=(e,t,r)=>{T(t,"store"),T(r,!1)},dn=(e,t,r,n)=>{T(t,Wt(r)),T(n,!0)},$t=(e,t,r)=>{T(t,"play"),T(r,!0)},mt=(e,t,r)=>{T(t,"entry"),T(r,!1)},Ut=(e,t)=>{T(t,Qe(o(t),r=>{qr(r)}))};var fn=F("<label>Auto Pistol Cooldown <!></label>"),vn=F('<div style="will-change: contents"> <!></div>'),pn=F('<div>Health</div> <div style="will-change: contents"> <!></div>',1),mn=F('<div style="will-change: contents"> <!></div>'),_n=F('<div>Sword</div> <label style="display: block;">Cooldown <!></label> <label style="display: block;">Fuel cost <!></label> <button style="border-radius: 9999px; border: 4px inset tomato; background-color: tomato; padding: 1em; display: block; aspect-ratio:1;">Swing</button>',1),yn=F('<div>Shield</div> <label style="display: block;">Cooldown <!></label> <label style="display: block;">Fuel cost <!></label> <label style="display:block;"> <!></label> <button style="border-radius: 9999px; border: 4px inset lightsteelblue; background-color: lightsteelblue; padding: 1em; display: block; aspect-ratio:1;">Block</button>',1),gn=F('<div style="padding: 1em; border: 2px outset;" class="svelte-1jve5dt"><!></div>'),hn=F('<a href="?"> </a>'),bn=F("<div><!></div>"),kn=F('<div style="display: flex; flex-direction: column; justify-content: start; align-items: flex-start; padding-bottom: 4em; gap:2em;" class="svelte-1jve5dt"><div class="svelte-1jve5dt"><h1 class="svelte-1jve5dt">Pilots</h1> <h2 class="svelte-1jve5dt">A game about ...?</h2></div> <div><a href="?">Cockpit</a></div> <div><a href="?">Shop</a></div> <div><a href="?">Inventory</a></div> <!> <div><a href="/design">Design notes</a></div></div>'),wn=F('<p><a href="?">Begin</a></p>'),xn=F('<p>Paused. <a href="?">Unpause</a></p>'),Pn=F('<!> <div style="border:4px inset; border-radius: 1em; padding: 2em; margin: 2em;" class="svelte-1jve5dt"><h2 class="svelte-1jve5dt">Enemy</h2> <div style="display: grid; grid-template-columns: 1fr 1fr;" class="svelte-1jve5dt"><!> <!></div></div> <h2 class="svelte-1jve5dt">Player</h2> <div style="display: grid; grid-template-columns: 1fr 1fr;" class="svelte-1jve5dt"><!> <!> <!> <!></div>',1),En=F('<h2 class="svelte-1jve5dt">Game over</h2> <p> </p>',1),Cn=F('<div class="svelte-1jve5dt"><!> <nav><a href="?">Restart</a> <a href="?">Back To Title</a> <!> <a href="?"> </a></nav></div>'),In=F('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div></div>'),Sn=F('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div></div>'),Tn=F(`<h2 class="svelte-1jve5dt"> </h2> <p style="padding-inline: 4em">This is your inventory where you can see your current parts. You can also rearrange your
        parts to maximize their effectiveness</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <h2 class="svelte-1jve5dt"> </h2> <p style="padding-inline: 4em">This is your enemy's inventory. Do you see what you're up against?</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <nav><a href="?">Back To Cockpit</a> <a href="?">Back To Title</a> <!></nav>`,1),Fn=(e,t,r)=>t(o(r)),An=F('<div style="display: flex; flex-direction: column; gap: 1em; border: 2px outset; padding-inline: 0.4em; padding-block: 0.4em;"><div style="display: flex; gap: 1em; flex-direction: row;"><div style="width: 30%; font-size: 1.4em"> </div> <div> </div></div> <div> <span> </span></div> <button>Sell</button></div>'),zn=F('<h2 class="svelte-1jve5dt">The Shop</h2> <p style="padding-inline: 4em">Buy more stuff here.</p> <div style="display: flex; flex-direction: column; gap: 0.4em;"></div> <nav><a href="?">Back To Cockpit</a> <a href="?">Back To Title</a> <!></nav>',1),Mn=F('<main style="width: calc(100vw - 1px); height: 100vh; display: grid; grid-template-rows: 1fr; grid-template-columns: 1fr; justify-items: center; align-items: center;" class="svelte-1jve5dt"><!></main>');function Nn(e,t){qt(t,!0);const r=m=>{var _=ve();const v=L(()=>Te(o(l),y,"autopistol"));var I=B(_);{var S=k=>{},D=k=>{var w=fn(),R=u(f(w));we(R,{get component(){return o(v)}}),c(w),g(k,w)};$(I,k=>{o(v)?k(D,!1):k(S)})}g(m,_)},n=m=>{var _=ve();const v=L(()=>Te(o(l),y,"health"));var I=B(_);{var S=k=>{},D=k=>{var w=vn(),R=f(w);U(()=>M(R,`Health ${o(v).formatter(o(v).value)??""}/${o(v).max??""} `));var P=u(R);we(P,{get component(){return o(v)}}),c(w),g(k,w)};$(I,k=>{o(v)?k(D,!1):k(S)})}g(m,_)},a=m=>{var _=ve();const v=L(()=>Te(o(l),b,"health"));var I=B(_);{var S=k=>{},D=k=>{var w=pn(),R=u(B(w),2),P=f(R);U(()=>M(P,`${o(v).formatter(o(v).value)??""}/${o(v).max??""} `));var j=u(P);we(j,{get component(){return o(v)}}),c(R),g(k,w)};$(I,k=>{o(v)?k(D,!1):k(S)})}g(m,_)},s=m=>{var _=ve();const v=L(()=>Te(o(l),b,"fuel"));var I=B(_);{var S=k=>{},D=k=>{var w=mn(),R=f(w);U(()=>M(R,`Fuel ${o(v).formatter(o(v).value)??""}/${o(v).max??""} `));var P=u(R);we(P,{get component(){return o(v)}}),c(w),g(k,w)};$(I,k=>{o(v)?k(D,!1):k(S)})}g(m,_)},i=m=>{var _=ve();const v=L(()=>Te(o(l),b,"sword")),I=L(()=>K(o(l),b,"fuel"));var S=B(_);{var D=w=>{},k=w=>{var R=_n(),P=u(B(R),2),j=u(f(P));we(j,{get component(){return o(v)}}),c(P);var W=u(P,2),he=u(f(W)),ie=L(()=>({min:o(I).min,max:o(v).costPerSwing,value:ee(o(I).value,o(I).min,o(v).costPerSwing)}));we(he,{get component(){return o(ie)}}),c(W);var Y=u(W,2),Z=L(()=>E(o(v).type));Y.__click=function(...me){var _e;(_e=o(Z))==null||_e.apply(this,me)},U(()=>Y.disabled=o(v).swinging),g(w,R)};$(S,w=>{o(v)?w(k,!1):w(D)})}g(m,_)},d=m=>{var _=ve();const v=L(()=>Te(o(l),b,"shield")),I=L(()=>K(o(l),b,"fuel"));var S=B(_);{var D=w=>{},k=w=>{var R=yn(),P=u(B(R),2),j=u(f(P));we(j,{get component(){return o(v)}}),c(P);var W=u(P,2),he=u(f(W)),ie=L(()=>({min:o(I).min,max:o(v).costPer,value:ee(o(I).value,o(I).min,o(v).costPer)}));we(he,{get component(){return o(ie)}}),c(W);var Y=u(W,2),Z=f(Y),me=u(Z),_e=L(()=>({min:0,max:o(v).totalUses,value:o(v).numUses}));we(me,{get component(){return o(_e)}}),c(Y);var xe=u(Y,2),X=L(()=>E(o(v).type));xe.__click=function(...V){var re;(re=o(X))==null||re.apply(this,V)},U(()=>{M(Z,`${o(v).numUses??""}/${o(v).totalUses??""} `),xe.disabled=o(v).blocking}),g(w,R)};$(S,w=>{o(v)?w(k,!1):w(D)})}g(m,_)},h=(m,_=Ze,v=Ze,I=Ze)=>{var S=Mn();const D=P=>{var j=hn();j.__click=function(...he){var ie;(ie=I())==null||ie.apply(this,he)};var W=f(j,!0);c(j),U(()=>M(W,v()?"Exit Fullscreen":"Fullscreen")),g(P,j)};var k=f(S);{var w=P=>{var j=kn(),W=u(f(j),2),he=f(W);he.__click=[Ot,C,l,p,x],c(W);var ie=u(W,2),Y=f(ie);Y.__click=[cn,C,x],c(ie);var Z=u(ie,2),me=f(Z);me.__click=[un,C,x],c(Z);var _e=u(Z,2);{var xe=X=>{var V=bn(),re=f(V);D(re),c(V),g(X,V)};$(_e,X=>{_()&&X(xe)})}Cr(2),c(j),g(P,j)},R=P=>{var j=ve(),W=B(j);{var he=Y=>{var Z=Cn(),me=f(Z);{var _e=G=>{var se=wn(),ke=f(se);ke.__click=[Ot,C,l,p,x],c(se),g(G,se)},xe=G=>{var se=ve(),ke=B(se);{var Re=H=>{var z=Pn(),N=B(z);{var Q=ot=>{var it=xn(),rr=u(f(it));rr.__click=[Ut,l],c(it),g(ot,it)};$(N,ot=>{o(l).round.state==="paused"&&ot(Q)})}var O=u(N,2),J=u(f(O),2),le=f(J);Oe(le,()=>n);var de=u(le,2);Oe(de,()=>r),c(J),c(O);var fe=u(O,4),ne=f(fe);Oe(ne,()=>a);var ue=u(ne,2);Oe(ue,()=>s);var ce=u(ue,2);Oe(ce,()=>i);var Se=u(ce,2);Oe(Se,()=>d),c(fe),g(H,z)},Ne=H=>{var z=ve(),N=B(z);{var Q=O=>{var J=En(),le=u(B(J),2),de=f(le);c(le),U(()=>M(de,`Reason: ${o(l).round.reason??""}`)),g(O,J)};$(N,O=>{o(l).round.state==="over"&&O(Q)},!0)}g(H,z)};$(ke,H=>{o(l).round.state==="occurring"||o(l).round.state==="paused"?H(Re):H(Ne,!1)},!0)}g(G,se)};$(me,G=>{o(l).round.state==="not yet started"?G(_e):G(xe,!1)})}var X=u(me,2),V=f(X);V.__click=[dn,l,p,x];var re=u(V,2);re.__click=[mt,C,x];var Me=u(re,2);{var be=G=>{D(G)};$(Me,G=>{_()&&G(be)})}var ye=u(Me,2);ye.__click=[Ut,l];var Ie=f(ye,!0);c(ye),c(X),c(Z),U(()=>M(Ie,o(te)?"Unpause (Paused)":"Pause")),g(Y,Z)},ie=Y=>{var Z=ve(),me=B(Z);{var _e=X=>{var V=Tn(),re=B(V),Me=f(re);U(()=>M(Me,`${$e(o(l),b).debug??""}'s Inventory`)),c(re);var be=u(re,4);ct(be,21,()=>o(l).parts.filter(({entityId:z})=>z===b),ut,(z,N)=>{var Q=In(),O=f(Q),J=f(O),le=f(J,!0);c(J);var de=u(J,2),fe=f(de,!0);c(de),c(O);var ne=u(O,2);De(ne,"font-size","0.8em");var ue=f(ne),ce=u(ue);De(ce,"font-size","0.8em");var Se=f(ce,!0);U(()=>M(Se,o(N).components.join(" "))),c(ce),c(ne),c(Q),U(()=>{M(le,o(N).title),M(fe,o(N).description),M(ue,`${o(N).type??""} `)}),g(z,Q)}),c(be);var ye=u(be,2),Ie=f(ye);U(()=>M(Ie,`${$e(o(l),y).debug??""}'s Inventory`)),c(ye);var G=u(ye,4);ct(G,21,()=>o(l).parts.filter(({entityId:z})=>z===y),ut,(z,N)=>{var Q=Sn(),O=f(Q),J=f(O),le=f(J,!0);c(J);var de=u(J,2),fe=f(de,!0);c(de),c(O);var ne=u(O,2);De(ne,"font-size","0.8em");var ue=f(ne),ce=u(ue);De(ce,"font-size","0.8em");var Se=f(ce,!0);U(()=>M(Se,o(N).components.join(" "))),c(ce),c(ne),c(Q),U(()=>{M(le,o(N).title),M(fe,o(N).description),M(ue,`${o(N).type??""} `)}),g(z,Q)}),c(G);var se=u(G,2),ke=f(se);ke.__click=[$t,C,x];var Re=u(ke,2);Re.__click=[mt,C,x];var Ne=u(Re,2);{var H=z=>{D(z)};$(Ne,z=>{_()&&z(H)})}c(se),g(X,V)},xe=X=>{var V=ve(),re=B(V);{var Me=be=>{var ye=zn(),Ie=u(B(ye),4);ct(Ie,21,()=>o(l).parts.filter(({entityId:H})=>H===b),ut,(H,z)=>{var N=An(),Q=f(N),O=f(Q),J=f(O,!0);c(O);var le=u(O,2),de=f(le,!0);c(le),c(Q);var fe=u(Q,2);De(fe,"font-size","0.8em");var ne=f(fe),ue=u(ne);De(ue,"font-size","0.8em");var ce=f(ue,!0);U(()=>M(ce,o(z).components.join(" "))),c(ue),c(fe);var Se=u(fe,2);Se.__click=[Fn,A,z],c(N),U(()=>{M(J,o(z).title),M(de,o(z).description),M(ne,`${o(z).type??""} `)}),g(H,N)}),c(Ie);var G=u(Ie,2),se=f(G);se.__click=[$t,C,x];var ke=u(se,2);ke.__click=[mt,C,x];var Re=u(ke,2);{var Ne=H=>{D(H)};$(Re,H=>{_()&&H(Ne)})}c(G),g(be,ye)};$(re,be=>{o(C)==="store"&&be(Me)},!0)}g(X,V)};$(me,X=>{o(C)==="inventory"?X(_e):X(xe,!1)},!0)}g(Y,Z)};$(W,Y=>{o(C)==="play"?Y(he):Y(ie,!1)},!0)}g(P,j)};$(k,P=>{o(C)==="entry"?P(w):P(R,!1)})}c(S),g(m,S)},E=m=>_=>{T(l,Qe(o(l),v=>{dt(v,{entityId:b,type:m,value:"buttonPressed",time:ge()})}))},A=m=>{T(l,Qe(o(l),_=>{Hr(_,m.entityId,m.type)}))},p=jr(),b=Ft(p,"Player");Ge(p,b,"core"),Ge(p,b,"sword"),Ge(p,b,"shield");const y=Ft(p,"Enemy");Ge(p,y,"core"),Ge(p,y,"autopistol"),dt(p,{entityId:b,type:"targeter",value:y,time:ge()}),dt(p,{entityId:y,type:"targeter",value:b,time:ge()});let l=Ce(p),x=Ce(!1);Er(()=>{let m=!1;const _=()=>{o(x)&&T(l,Qe(o(l),v=>{Wr(v)})),m||requestAnimationFrame(_)};return requestAnimationFrame(_),()=>{m=!0}});let C=Ce("entry");const te=L(()=>o(l).round.state==="paused");$r(e,{fullscreenable:h}),jt()}Gt(["click"]);export{Nn as component};
