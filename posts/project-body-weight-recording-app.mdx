# Project: Body Weight Recording App 

## Logbook

### Sat Dec 23 03:02:52 PM PST 2023

I started this project to branch off from my <Link slug="project-supabase-authentication" hash="supabase-auth-starting-body-weight-app">exploration of Supabase authentication</Link>. Eventually, I wanted to stretch out into a diet and whole fitness application. I thought that starting with a much simpler weight tracker made more sense than sprinting for gold out of the gate.

I wanted to use this website as my application. To begin, I could use this project page as the application. Later, I'd make a dedicated page e.g. `https://reeds.website/fitness`

I began by creating a table in my Supabase database. I made it as simple as possible. It had four columns: An auto-incrementing ID, a `created_at` timestamp, a foreign key `user_id` to connect with Supabase's `auth` system which I had just figured out, and a `kilograms` field for my observed weight. I weigh myself in pounds, but it just felt weird instilling the US system of weights and measures into a database which I wanted to be maintainable. Don't at me
.

<Future>I considered adding a "time" column to my weight table, so that people could update the date. I could imagine myself needing override the "created at" property when I forgot to record my observation until the next day, for example. The `created_at` column was modifiable both at insertion and update so I could always edit that. However maybe for tracking it would be good to never edit that property and always update a separate column.</Future>

<Future>I considered adding a "skipped" boolean column to my weight table, to differentiate between an intentional skipping of data entry versus a forgotten habit. I didn't have a strong use-case in mind at the time, but my favorite habit tracking app had this feature.</Future>

<Future>I added a way in my application to detect entries which duplicated the same day, so that users (me) might be prompted and have the proper resources to clean up their own data</Future>

<Future>To get started with the client-side I built a quick form to enter this data. I thought that would be the most straightforward until I realized I didn't know where the data was going. Also would I have to use Supabase's JavaScript API to supply my authentication data? Or would cookies established with my authentication work so far be sufficient? Once I had the form working with a normal, page refreshing action, I set up `htmx` to perform an insert without a page refresh. That took some work to hook up htmx and Supabase's auth token.</Future>

<Future>I needed users to be authenticated on this page, so I made a component which I could import for any page to log in. I didn't want to put it in my generic page shell yet, because I didn't have a complete story for what it meant to be authenticated across the application. I didn't want anyone to get the wrong idea that they should be authenticating just because they see a Sign In button, only to realize absolutely no change in functionality in 99% of my site.</Future>

<Future>Then I added Row Level checks to only allow users to read their own records and write records with their own user ID. I wasn't sure it worked so I had to test it. I decided to create a second email and password user and fill in some data. Then I could insert data via the API for my second user, and run a test to see whether I could query data from my first user at all. If I couldn't figure out a way to get that other data, I'd consider my Row Level policy to be working.</Future>

<Future>Once I had confidence in inserting data into the database table, I made a way to query my data. I decided to throw it all in an HTML table for now. I used htmx to fetch the data on page-load if authenticated. That took some work to hook up htmx and Supabase's auth token. Then I triggered this data to refresh from the server after an insertion.</Future>
